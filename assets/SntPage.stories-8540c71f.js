var ae=Object.defineProperty;var le=(t,e,s)=>e in t?ae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var i=(t,e,s)=>(le(t,typeof e!="symbol"?e+"":e,s),s);import{j as n,a as m}from"./jsx-runtime-09ad29cb.js";import{r as T}from"./index-f2bd0723.js";import{e as l,S as ce,b as de,u as D,c as ue,W as he,C as N,f as C,H as me}from"./useTranslation-c9ed8fc3.js";import{m as S,o as f,c as te}from"./index-4a18183b.js";import{P as a}from"./index-419aef79.js";import{S as pe}from"./SntHeaderTooltip-92cd8817.js";import{r as ye,S as ge}from"./SntListFilter-a04f38f1.js";import{T as fe}from"./Table-a7dd2540.js";import"./_commonjsHelpers-042e6b4d.js";import"./index-0a26bc51.js";import"./context-e85a40ef.js";import"./translation-23d3ab7c.js";class be{constructor(e,s={}){i(this,"values",{});i(this,"errors",{});i(this,"changeValue",(e,s="")=>{this.values[s]=e,this.validate(s)});i(this,"reset",(e="")=>{e?this.resetByKey(e):Object.keys(this.values).forEach(s=>{this.resetByKey(s)})});i(this,"resetByKey",e=>{this.values[e]=typeof this.formForReset[e]!==void 0?this.formForReset[e]:null,this.errors[e]=null});i(this,"setForm",(e={})=>{Object.entries(e).forEach(([s,r])=>{this.values[s]=r})});i(this,"validate",(e="")=>{if(e)return this.validateByKey(e);{const s=[];return Object.keys(this.validators).forEach(r=>{s.includes(r)||s.push(r)}),Object.keys(this.values).forEach(r=>{s.includes(r)||s.push(r)}),s.forEach(r=>this.validateByKey(r))}});i(this,"getValuesExcludeByKey",e=>{const s={};return Object.entries(this.values).forEach(([r,d])=>{r!==e&&(s[r]=d)}),s});i(this,"validateByKey",async e=>{this.errors[e]=null;const s=this.validators[e];s&&Array.isArray(s)&&s.some(r=>{const d=this.values[e],h=r(d,this.getValuesExcludeByKey(e));return h&&(this.errors[e]=h),!!h})});this.values=e,this.validators=s,this.formForReset=JSON.parse(JSON.stringify(e)),S(this)}get isValid(){return!Object.entries(this.validators).some(([s,r])=>Array.isArray(r)?r.some(d=>typeof d=="function"?!!d(this.values[s],this.getValuesExcludeByKey(s)):!1):!1)}}class ve{constructor(e){i(this,"isActive",!1);i(this,"typeVariants",["all","avio","auto"]);i(this,"form",new be({search:"",senderCity:"",senderFio:"",senderPhone:"",receiverCity:"",receiverFio:"",receiverPhone:"",readyToInput:!1,type:this.typeVariants[0]}));i(this,"setIsActive",e=>{this.isActive=e});i(this,"toggleActive",()=>{this.setIsActive(!this.isActive)});i(this,"setType",e=>{this.form.changeValue(e,"type"),this.getItems()});this.getItems=()=>e(),S(this)}}const g=["dateCreation","internetShopNumber","cityFrom","planingDepartureDate","transportNumber"];class se{constructor(e){i(this,"sortBy",null);i(this,"sortDirectionReverse",!1);i(this,"setSortBy",e=>{e===this.sortBy?this.sortDirectionReverse=!this.sortDirectionReverse:(this.sortBy=e,this.sortDirectionReverse=!1),this.getItems()});this.getItems=()=>e(),S(this)}reset(){this.sortBy=null,this.sortDirectionReverse=!1}}class Se{constructor(e){i(this,"value","");i(this,"numberSntEditRequired",!1);i(this,"numberSntMessage","");i(this,"id","");i(this,"isLoading",!1);i(this,"isSaveComplete",!1);i(this,"error",null);i(this,"onChangeValue",e=>{this.value=e,this.startSaveAfterDelay()});i(this,"startSaveAfterDelay",(e=2e3)=>{clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(()=>{this.saveValue()},e)});i(this,"changeIsLoading",e=>{this.isLoading=e});i(this,"saveValue",()=>(console.log("save value"),this.changeIsLoading(!0),clearTimeout(this.saveTimeout),this.error=null,new Promise(e=>{setTimeout(()=>{Math.random()>.5?this.isSaveComplete=!0:(this.isSaveComplete=!1,this.error="Чето пошло не так исправь!!!1111"),this.changeIsLoading(!1),e()},Math.random()*1e3*3)})));e&&(this.value=e.numberSnt||"",this.numberSntEditRequired=e.numberSntEditRequired,this.numberSntMessage=e.numberSntMessage,this.id=e.number),S(this)}}class z{constructor(e){i(this,"number");i(this,"dateCreation");i(this,"internetShopNumber");i(this,"cityFrom");i(this,"cityTo");i(this,"planingDepartureDate");i(this,"transportType");i(this,"transportNumber");i(this,"driverName");i(this,"onChangeNumberSnt",e=>{this.numberSnt=e});Object.keys(e).forEach(s=>{this[s]=e[s]}),this.snt=new Se(e),S(this)}}class _e{constructor(){i(this,"items",[]);i(this,"addItem",e=>{this.items.push(new z(e))});i(this,"setItems",e=>{e.forEach(s=>{this.addItem(s)})});i(this,"reset",()=>{this.items=[]});S(this)}}class Ne{constructor(){i(this,"isLoading",!1);i(this,"init",()=>{this.getItems()});i(this,"getItems",()=>{this.list.reset(),this.fetchItems().then(e=>{this.list.setItems(e)})});i(this,"fetchItems",async()=>{this.isLoading=!0;const e=()=>({number:Math.random()*1e6,dateCreation:new Date,internetShopNumber:Math.random()*1e6,cityFrom:"Санкт-Петербург",cityTo:"Воронеж",planingDepartureDate:new Date,transportType:"auto",transportNumber:Math.random()>.3?"А981BH761":null,driverName:Math.random()>.3?"Золотарев Максим Семенович":null,numberSnt:Math.random()>.5?"45g-45g-45-g42-g-4h55jq--35--hqhq34":null,numberSntEditRequired:Math.random()>.5,numberSntMessage:"Необходимо обновить номер СНТ"}),s=Array.from({length:10},e);return new Promise(r=>{setTimeout(()=>{this.isLoading=!1,r(s)},Math.random()*1e3*3)})});i(this,"reset",()=>{});i(this,"getMore",()=>this.fetchItems().then(e=>{this.list.setItems(e)}));this.list=new _e,this.filter=new ve(()=>this.getItems()),this.sorting=new se(()=>this.getItems()),S(this)}}const Ce="_divider_12ncq_1",Le={divider:Ce},re=()=>n("div",{className:Le.divider});re.__docgenInfo={description:"",methods:[],displayName:"Divider"};const K=new Map,w=new WeakMap;let Q=0,Te;function Ie(t){return t?(w.has(t)||(Q+=1,w.set(t,Q.toString())),w.get(t)):"0"}function Be(t){return Object.keys(t).sort().filter(e=>t[e]!==void 0).map(e=>`${e}_${e==="root"?Ie(t.root):t[e]}`).toString()}function De(t){let e=Be(t),s=K.get(e);if(!s){const r=new Map;let d;const h=new IntersectionObserver(p=>{p.forEach(u=>{var y;const R=u.isIntersecting&&d.some(_=>u.intersectionRatio>=_);t.trackVisibility&&typeof u.isVisible>"u"&&(u.isVisible=R),(y=r.get(u.target))==null||y.forEach(_=>{_(R,u)})})},t);d=h.thresholds||(Array.isArray(t.threshold)?t.threshold:[t.threshold||0]),s={id:e,observer:h,elements:r},K.set(e,s)}return s}function Re(t,e,s={},r=Te){if(typeof window.IntersectionObserver>"u"&&r!==void 0){const y=t.getBoundingClientRect();return e(r,{isIntersecting:r,target:t,intersectionRatio:typeof s.threshold=="number"?s.threshold:0,time:0,boundingClientRect:y,intersectionRect:y,rootBounds:y}),()=>{}}const{id:d,observer:h,elements:p}=De(s);let u=p.get(t)||[];return p.has(t)||p.set(t,u),u.push(e),h.observe(t),function(){u.splice(u.indexOf(e),1),u.length===0&&(p.delete(t),h.unobserve(t)),p.size===0&&(h.disconnect(),K.delete(d))}}function we({threshold:t,delay:e,trackVisibility:s,rootMargin:r,root:d,triggerOnce:h,skip:p,initialInView:u,fallbackInView:y,onChange:R}={}){var _;const[I,oe]=T.useState(null),P=T.useRef(),[k,G]=T.useState({inView:!!u,entry:void 0});P.current=R,T.useEffect(()=>{if(p||!I)return;let B=Re(I,(J,F)=>{G({inView:J,entry:F}),P.current&&P.current(J,F),F.isIntersecting&&h&&B&&(B(),B=void 0)},{root:d,rootMargin:r,threshold:t,trackVisibility:s,delay:e},y);return()=>{B&&B()}},[Array.isArray(t)?t.toString():t,I,d,r,h,p,s,y,e]);const W=(_=k.entry)==null?void 0:_.target;T.useEffect(()=>{!I&&W&&!h&&!p&&G({inView:!!u,entry:void 0})},[I,W,h,p,u]);const b=[oe,k.inView,k.entry];return b.ref=b[0],b.inView=b[1],b.entry=b[2],b}const Me="_loader_14ajm_1",U={loader:Me},E=t=>{const{ref:e}=we({threshold:.5,async onChange(s){s&&!t.isLoading&&t.getMoreCallback&&setTimeout(()=>{t.getMoreCallback()},500)}});return t.isLoading?n("div",{className:U.loader,children:n(l.Spinner,{size:ce.Md,color:de.Primary})}):n("div",{ref:e,className:U.loader})};E.propTypes={getMoreCallback:a.func,isLoading:a.bool};E.displayName="LoaderOrGetMore";const qe=f(E);E.__docgenInfo={description:"",methods:[],displayName:"LoaderOrGetMore",props:{getMoreCallback:{type:{name:"func"},required:!1,description:""},isLoading:{type:{name:"bool"},required:!1,description:""}}};const Ee="_button_84uii_1",Oe={button:Ee},O=t=>{const{t:e}=D();return n("button",{className:Oe.button,title:e("snt.copyToClipboard"),onClick:()=>{navigator.clipboard.writeText(t.value)},children:n(l.IconCopy,{})})};O.propTypes={value:a.string};O.displayName="CopyButton";const ne=f(O);O.__docgenInfo={description:"",methods:[],displayName:"CopyButton",props:{value:{type:{name:"string"},required:!1,description:""}}};const Ve="_input_12tb9_1",$e={input:Ve},V=t=>{const{t:e}=D();return n(l.Input,{className:te($e.input,t.className),value:t.value,onChange:s=>{t.onChangeValue(s.target.value)},disabled:!t.numberSntEditRequired||t.isLoading,placeholder:e("snt.enterNumber"),hideClearButton:!0,onKeyPress:s=>{s.key==="Enter"&&t.saveValue()},messageError:t.error,isInvalid:!!t.error,iconRight:t.isLoading?n(l.Spinner,{}):t.isSaveComplete?n(l.IconCheck,{}):void 0})};V.propTypes={value:a.string,className:a.string,error:a.string,onChangeValue:a.func,saveValue:a.func,numberSntEditRequired:a.bool,isLoading:a.bool,isSaveComplete:a.bool};V.displayName="SntNumberInput";const ie=f(V);V.__docgenInfo={description:"",methods:[],displayName:"SntNumberInput",props:{value:{type:{name:"string"},required:!1,description:""},className:{type:{name:"string"},required:!1,description:""},error:{type:{name:"string"},required:!1,description:""},onChangeValue:{type:{name:"func"},required:!1,description:""},saveValue:{type:{name:"func"},required:!1,description:""},numberSntEditRequired:{type:{name:"bool"},required:!1,description:""},isLoading:{type:{name:"bool"},required:!1,description:""},isSaveComplete:{type:{name:"bool"},required:!1,description:""}}};const xe="_button_1moo6_1",je="_transport_1moo6_13",X={button:xe,transport:je},Ae="_button_1usdb_1",Pe="_left_1usdb_17",ke="_right_1usdb_22",Fe="_rightReverse_1usdb_28",M={button:Ae,left:Pe,right:ke,rightReverse:Fe},$=t=>m("button",{className:M.button,...t,children:[n("div",{className:M.left,children:t.children}),t.isSorted?n("div",{className:te(M.right,t.isSortedRevers?M.rightReverse:null),children:n(ue,{})}):null]});$.propTypes={children:a.node,isSorted:a.bool,isSortedRevers:a.bool};$.displayName="TableSortButton";const L=f($);$.__docgenInfo={description:"",methods:[],displayName:"TableSortButton",props:{children:{type:{name:"node"},required:!1,description:""},isSorted:{type:{name:"bool"},required:!1,description:""},isSortedRevers:{type:{name:"bool"},required:!1,description:""}}};const c=["numberAndDateCreation","imShopNumber","fromTo","departureTime","transport","sntNumber"],x=t=>{var s;const{t:e}=D();return n("div",{className:X.block,children:n(fe,{columns:[{key:c[0],label:n(L,{onClick:()=>{t.sorting.setSortBy(g[0])},isSorted:[g[0]].includes(t.sorting.sortBy),isSortedRevers:t.sorting.sortDirectionReverse,children:e(`snt.tableColumns.${c[0]}`)})},{key:c[1],label:n(L,{onClick:()=>{t.sorting.setSortBy(g[1])},isSorted:[g[1]].includes(t.sorting.sortBy),isSortedRevers:t.sorting.sortDirectionReverse,children:e(`snt.tableColumns.${c[1]}`)})},{key:c[2],label:n(L,{onClick:()=>{t.sorting.setSortBy(g[2])},isSorted:[g[2]].includes(t.sorting.sortBy),isSortedRevers:t.sorting.sortDirectionReverse,children:e(`snt.tableColumns.${c[2]}`)})},{key:c[3],label:n(L,{onClick:()=>{t.sorting.setSortBy(g[3])},isSorted:[g[3]].includes(t.sorting.sortBy),isSortedRevers:t.sorting.sortDirectionReverse,children:e(`snt.tableColumns.${c[3]}`)})},{key:c[4],label:n(L,{onClick:()=>{t.sorting.setSortBy(g[4])},isSorted:[g[4]].includes(t.sorting.sortBy),isSortedRevers:t.sorting.sortDirectionReverse,children:e(`snt.tableColumns.${c[4]}`)})},{key:c[5],label:n(L,{children:e(`snt.tableColumns.${c[5]}`)})}],data:(s=t.items)==null?void 0:s.map(r=>({[c[0]]:m("div",{children:[n("div",{children:new Date(r.dateCreation).toLocaleDateString()}),n("div",{children:r.number})]}),[c[1]]:r.internetShopNumber,[c[2]]:[r.cityFrom,r.cityTo].filter(Boolean).join(" - "),[c[3]]:[new Date(r.planingDepartureDate).toLocaleDateString(),new Date(r.planingDepartureDate).toLocaleTimeString()].filter(Boolean).join(" "),[c[4]]:r.transportNumber||r.driverName?m("div",{className:X.transport,children:[m("div",{children:[n("div",{children:r.transportNumber}),n("div",{children:r.driverName})]}),n(ne,{value:[r.transportNumber,r.driverName].filter(Boolean).join(" ")})]}):"...",[c[5]]:n(ie,{...r.snt})}))})})};x.propTypes={children:a.node,items:a.arrayOf(a.instanceOf(z)),sorting:a.instanceOf(se)};x.displayName="SntListDesktop";const Ke=f(x);x.__docgenInfo={description:"",methods:[],displayName:"SntListDesktop",props:{children:{type:{name:"node"},required:!1,description:""},items:{type:{name:"arrayOf",value:{name:"instanceOf",value:"SntListItemStore"}},required:!1,description:""},sorting:{type:{name:"instanceOf",value:"SntListSortingStore"},required:!1,description:""}}};const ze="_list_mhgx3_1",He="_item_mhgx3_7",Ge="_body_mhgx3_11",We="_header_mhgx3_20",Je="_headerValue_mhgx3_28",Qe="_row_mhgx3_32",Ue="_rowLeft_mhgx3_39",Xe="_input_mhgx3_46",Ye="_label_mhgx3_50",o={list:ze,item:He,body:Ge,header:We,headerValue:Je,row:Qe,rowLeft:Ue,input:Xe,label:Ye},j=t=>{var s;const{t:e}=D();return n("div",{className:o.list,children:(s=t.items)==null?void 0:s.map((r,d)=>n(l.Widget,{className:o.item,size:he.Size2,children:m("div",{className:o.body,children:[m("div",{className:o.header,children:[n(l.Typography,{className:o.headerValue,type:N.Caption1,children:r.number}),n(l.Typography,{className:o.headerValue,type:N.Caption1,children:new Date(r.dateCreation).toLocaleDateString()})]}),n("div",{children:n(l.Typography,{type:C.Body2,children:[r.cityFrom,r.cityTo].join(" → ")})}),n("div",{className:o.row,children:m("div",{className:o.rowLeft,children:[n(l.Typography,{className:o.label,type:N.Caption1,children:e("snt.tableColumns.imShopNumber")}),n(l.Typography,{className:o.value,type:C.Body2,children:r.internetShopNumber})]})}),n("div",{className:o.row,children:m("div",{className:o.rowLeft,children:[n(l.Typography,{className:o.label,type:N.Caption1,children:e("snt.tableColumns.departureTime")}),n(l.Typography,{className:o.value,type:C.Body2,children:[new Date(r.planingDepartureDate).toLocaleDateString(),new Date(r.planingDepartureDate).toLocaleTimeString()].filter(Boolean).join(" ")})]})}),m("div",{className:o.row,children:[m("div",{className:o.rowLeft,children:[n(l.Typography,{className:o.label,type:N.Caption1,children:e("snt.tableColumns.transport")}),n(l.Typography,{className:o.value,type:C.Body2,children:r.transportNumber||"..."}),n(l.Typography,{className:o.value,type:C.Body2,children:r.driverName||"..."})]}),n(ne,{value:[r.transportNumber,r.driverName].filter(Boolean).join(" ")})]}),n("div",{className:o.row,children:m("div",{className:o.rowLeft,children:[n(l.Typography,{className:o.label,type:N.Caption1,children:e("snt.tableColumns.sntNumber")}),r.snt.numberSntEditRequired?n(ie,{...r.snt,className:o.input}):n(l.Typography,{className:o.value,type:C.Body2,children:e("snt.informationShowLater")})]})})]})},d))})};j.propTypes={items:a.arrayOf(a.instanceOf(z))};j.displayName="SntListMobile";const Ze=f(j);j.__docgenInfo={description:"",methods:[],displayName:"SntListMobile",props:{items:{type:{name:"arrayOf",value:{name:"instanceOf",value:"SntListItemStore"}},required:!1,description:""}}};const A=t=>ye.useMediaQuery({query:"(max-width: 600px)"})?n(Ze,{...t}):n(Ke,{...t}),et={items:a.arrayOf(a.shape({}))};A.propTypes=et;A.displayName="SntList";const tt=f(A);A.__docgenInfo={description:"",methods:[],displayName:"SntList",props:{items:{type:{name:"arrayOf",value:{name:"shape",value:{}}},required:!1,description:""}}};const st="_block_u5pb0_1",rt={block:st},v=new Ne,H=()=>{const{t}=D();return T.useEffect(()=>(v.init(),()=>v.reset()),[]),m("div",{className:rt.block,children:[m(l.Typography,{type:me.H4,children:[t("snt.header")," ",n(pe,{})]}),n(re,{}),n(ge,{...v.filter}),n(tt,{items:v.list.items,sorting:v.sorting}),n(qe,{isLoading:v.isLoading,getMoreCallback:v.getMore})]})};H.displayName="SntPage";const nt=f(H);H.__docgenInfo={description:"",methods:[],displayName:"SntPage"};const bt={title:"snt/Page",component:nt,parameters:{backgrounds:{default:"blue"}}},q={};var Y,Z,ee;q.parameters={...q.parameters,docs:{...(Y=q.parameters)==null?void 0:Y.docs,source:{originalSource:"{}",...(ee=(Z=q.parameters)==null?void 0:Z.docs)==null?void 0:ee.source}}};const vt=["Default"];export{q as Default,vt as __namedExportsOrder,bt as default};
//# sourceMappingURL=SntPage.stories-8540c71f.js.map
